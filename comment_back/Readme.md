## DRF ModelSerializerì—ì„œ ê´€ê³„ í•„ë“œì˜ ì…ë ¥ê³¼ ê²€ì¦ ê²°ê³¼

### í˜„ìƒ ìš”ì•½

- **ì…ë ¥ ì‹œ**:  
  ê´€ê³„ í•„ë“œ(ì˜ˆ: ForeignKey, OneToOneField, ManyToManyField)ëŠ”  
  **pk(ì •ìˆ˜, id)** ê°’ìœ¼ë¡œ ì…ë ¥ë°›ëŠ”ë‹¤.

- **ê²€ì¦ í›„**:  
  `serializer.is_valid()`ê°€ í˜¸ì¶œë˜ê³  ë‚˜ë©´  
  **validated_data**ì—ëŠ” í•´ë‹¹ pkì— í•´ë‹¹í•˜ëŠ” **ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤(ê°ì²´)**ê°€ ë“¤ì–´ê°„ë‹¤.

---

### ì™œ ì´ëŸ°ê°€?

- DRFì˜ `ModelSerializer`ëŠ” ê´€ê³„ í•„ë“œì— ëŒ€í•´ ë‚´ë¶€ì ìœ¼ë¡œ `PrimaryKeyRelatedField`ë¥¼ ì‚¬ìš©í•œë‹¤.
- ì´ í•„ë“œëŠ” ì…ë ¥ê°’ì´ pkì¼ ë•Œ, ê²€ì¦ ê³¼ì •ì—ì„œ í•´ë‹¹ pkë¡œ DBì—ì„œ ê°ì²´ë¥¼ ì¡°íšŒí•˜ì—¬  
  **validated_dataì— ì‹¤ì œ ëª¨ë¸ ê°ì²´ë¡œ ë³€í™˜**í•´ ì¤€ë‹¤.

---

### ì˜ˆì‹œ ì½”ë“œ

```python
# ì…ë ¥ ì‹œ
serializer = CommentEmotionAnalysisSerializer(data={"comment": 123})

# ê²€ì¦ ì „
serializer.initial_data["comment"]  # 123 (pk)

# ê²€ì¦
serializer.is_valid()

# ê²€ì¦ í›„
serializer.validated_data["comment"]  # <Comment: ...> (Comment ê°ì²´)
```

---

### ì‹œë¦¬ì–¼ë¼ì´ì €ì˜ ê²€ì¦ ì‹œì 

- DRFì—ì„œ ì‹œë¦¬ì–¼ë¼ì´ì €ì˜ ê²€ì¦ì€ **`serializer.is_valid()` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ìˆœê°„** ê²°ì •ë©ë‹ˆë‹¤.
- ì´ ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ë©´ ì…ë ¥ ë°ì´í„°ì— ëŒ€í•œ ìœ íš¨ì„± ê²€ì‚¬ì™€ ë³€í™˜ì´ í•œ ë²ˆì— ì´ë£¨ì–´ì§‘ë‹ˆë‹¤.
- ê²€ì¦ì´ í†µê³¼í•˜ë©´, `serializer.validated_data`ì— ë³€í™˜ëœ(ì˜ˆ: pk â†’ ê°ì²´) ê°’ì´ ì €ì¥ë©ë‹ˆë‹¤.
- ê²€ì¦ì´ ì‹¤íŒ¨í•˜ë©´, `serializer.errors`ì— ì—ëŸ¬ ì •ë³´ê°€ ì €ì¥ë©ë‹ˆë‹¤.

**ì •ë¦¬:**

- ì‹œë¦¬ì–¼ë¼ì´ì €ì˜ ê²€ì¦ì€ `is_valid()` í˜¸ì¶œ ì‹œì ì— ì‹¤í–‰ëœë‹¤.
- ì´ë•Œ validated_dataê°€ ì±„ì›Œì§€ê³ , ê´€ê³„ í•„ë“œëŠ” pkì—ì„œ ê°ì²´ë¡œ ë³€í™˜ëœë‹¤.

---

### ê²°ë¡ 

- **ì…ë ¥**: pk ê°’(int)
- **ê²€ì¦ í›„**: ì‹¤ì œ ëª¨ë¸ ì¸ìŠ¤í„´ìŠ¤
- ì´ ë™ì‘ì€ DRFì˜ í‘œì¤€ì´ë©°, ê´€ê³„ í•„ë“œì˜ ì¼ê´€ëœ ì²˜ë¦¬ ë°©ì‹ì´ë‹¤.
- ë”°ë¼ì„œ, ì‹œë¦¬ì–¼ë¼ì´ì € ë‚´ë¶€ì—ì„œ validated_data["comment"]ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” í•­ìƒ ê°ì²´ê°€ ë“¤ì–´ì˜¨ë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.

---

**ì°¸ê³ :**

- ê³µì‹ ë¬¸ì„œ: [DRF PrimaryKeyRelatedField](https://www.django-rest-framework.org/api-guide/relations/#primarykeyrelatedfield)








![alt text](image-5.png)

## Django API ì„±ëŠ¥ ê°œì„ : 6ì´ˆì—ì„œ 300msë¡œ ì‘ë‹µ ì†ë„ ë‹¨ì¶•

### 1. ë¬¸ì œ ìƒí™©

ëŒ“ê¸€ ìš”ì•½ ìƒì„± API ìš”ì²­ ì‹œ, **ì‘ë‹µ ì‹œê°„ì´ 6ì´ˆ ì´ìƒ** ì†Œìš”ë˜ëŠ” ì‹¬ê°í•œ ì„±ëŠ¥ ì €í•˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.  
Django Debug Toolbarë¡œ í™•ì¸í•œ ê²°ê³¼, **API í˜¸ì¶œ í•œ ë²ˆì— 500ê°œ ì´ìƒì˜ SQL ì¿¼ë¦¬**ê°€ ì‹¤í–‰ë˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤.

---

### 2. ì›ì¸ ë¶„ì„

ì¿¼ë¦¬ ë¡œê·¸ë¥¼ ìƒì„¸íˆ ë¶„ì„í•œ ê²°ê³¼, 500ê°œê°€ ë„˜ëŠ” ì¿¼ë¦¬ì˜ ì´ ì‹¤í–‰ ì‹œê°„(SQL time)ì€ **ì•½ 400msì— ë¶ˆê³¼**í–ˆìŠµë‹ˆë‹¤.  
ì´ë¥¼ í†µí•´ **DB ì„±ëŠ¥ì´ ì•„ë‹Œ, Django ORM ì˜¤ë²„í—¤ë“œ**ê°€ ë³‘ëª©ì˜ ì›ì¸ì„ì„ ì¶”ì •í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

#### ğŸ“Œ ê·¼ë³¸ ì›ì¸

- `Serializer`ì˜ `ManyToManyField` ìœ íš¨ì„± ê²€ì‚¬ ê³¼ì •ì—ì„œ **N+1 ì¿¼ë¦¬ ë¬¸ì œ** ë°œìƒ
- ëŒ“ê¸€ ID ëª©ë¡ì„ ê°œë³„ì ìœ¼ë¡œ `SELECT`í•˜ì—¬ ìœ íš¨ì„± ê²€ì‚¬ ìˆ˜í–‰
- ëŒ“ê¸€ ìˆ˜ë§Œí¼ **ë¶ˆí•„ìš”í•œ DB ì ‘ê·¼**ì´ ë°œìƒ

---

### 3. í•´ê²° ê³¼ì •

ë‹¨ìˆœ ì¿¼ë¦¬ ìµœì í™”ë¥¼ ë„˜ì–´ì„œ **ë°ì´í„° ëª¨ë¸ë§ì˜ ì ì ˆì„±**ì„ ì¬ê²€í† í–ˆìŠµë‹ˆë‹¤.

#### ğŸ” ìš”êµ¬ì‚¬í•­ ì¬ì •ì˜

- ëª©í‘œ: **ìš”ì•½ ìƒì„± ì‹œì ì˜ ëŒ“ê¸€ ëª©ë¡**ì„ ì €ì¥
- í•„ìš” ì—†ìŒ: ëŒ“ê¸€ â†’ ìš”ì•½ ì—­ì°¸ì¡°

#### ğŸ› ï¸ í•´ê²° ë°©ë²•

- ì‹¤ì‹œê°„ ê´€ê³„ë¥¼ ìœ„í•œ `ManyToManyField` â†’ ê³¼ë„í•œ ì„¤ê³„
ì „
![alt text](image-4.png)
í›„
![alt text](image-3.png)
- â†’ `JSONField`ë¡œ ë³€ê²½í•˜ì—¬ **ëŒ“ê¸€ ID ë¦¬ìŠ¤íŠ¸ë¥¼ Snapshot ë°©ì‹ìœ¼ë¡œ ì €ì¥**
- ì´ë¥¼ í†µí•´ DjangoëŠ” ë” ì´ìƒ ë¬´ê²°ì„± ê²€ì¦ì„ ìœ„í•œ ìˆ˜ë°± ê°œì˜ ì¿¼ë¦¬ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê²Œ ë¨

---

### 4. ê°œì„  ê²°ê³¼
![alt text](image-1.png)

| í•­ëª©             | ê°œì„  ì „     | ê°œì„  í›„         | ë¹„ê³                                             |
| ---------------- | ----------- | --------------- | ----------------------------------------------- |
| â±ï¸ API ì‘ë‹µ ì‹œê°„ | ì•½ 6000ms   | **300ms ë‚´ì™¸**  | ì•½ **20ë°° ì„±ëŠ¥ í–¥ìƒ**                           |
| ğŸ”„ SQL ì¿¼ë¦¬ ìˆ˜   | 500ê°œ ì´ìƒ  | **4ê°œ**         |                                                 |
| ğŸ§· ë°ì´í„° ë¬´ê²°ì„± | ì‹¤ì‹œê°„ ì°¸ì¡° | **ìŠ¤ëƒ…ìƒ· ë³´ì¡´** | ì›ë³¸ ëŒ“ê¸€ ìˆ˜ì •/ì‚­ì œì™€ ë¬´ê´€í•˜ê²Œ ìš”ì•½ ë°ì´í„° ìœ ì§€ |

> ğŸ’¡ _ê²°ê³¼ì ìœ¼ë¡œ, JSON ê¸°ë°˜ Snapshot ì „ëµì€ ì„±ëŠ¥ì„ ëŒ€í­ í–¥ìƒì‹œì¼°ì„ ë¿ ì•„ë‹ˆë¼,  
> ë°ì´í„°ì˜ ì—­ì‚¬ì  ë¬´ê²°ì„±ë„ í•¨ê»˜ ê°•í™”í•˜ëŠ” íš¨ê³¼ë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤._

---
